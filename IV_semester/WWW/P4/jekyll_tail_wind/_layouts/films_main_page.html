<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>{{ page.title }}</title>
    <link rel="stylesheet" href="{{ '/assets/css/output.css' | asset_url }}">
    <script src="https://www.youtube.com/iframe_api"></script> <!-- Load YouTube Player API -->
  </head>
  <body>
    <header>
      {% include header_post.html %}
    </header>
    <main>
      <section class="flex flex-wrap gap-4">
        <!-- <h2 class="title">{{ page.title }}</h2> -->
        {% for movie in site.data.movies_data -%}
        <a href="{{ movie.url }}">
          <div 
            class="movie relative group w-120 h-60 overflow-hidden border rounded-lg shadow-lg shadow-yellow-500"
            onmouseover="startVideo(this)" 
            onmouseout="pauseVideo(this)"
          >
            <img src="{{ movie.image_url }}" alt="{{ movie.title }}" class="w-full h-full object-cover">
            <div class="absolute inset-0 bg-black bg-opacity-70 text-white opacity-0 group-hover:opacity-100 flex flex-col justify-center items-center p-4 transition-opacity duration-300">
              <h3 class="text-lg font-bold mb-2">{{ movie.title | split: ') '| last}}</h3>
              <!-- <p><strong>Director:</strong> {{ movie.director }}</p> -->
              <!-- <p><strong>Starring:</strong> {{ movie.starring }}</p> -->
                <iframe 
                  id="player-{{ forloop.index }}"
                  width="560" 
                  height="315" 
                  data-src="{{ movie.trailer }}" 
                  src="about:blank" 
                  title="YouTube video player" 
                  frameborder="0" 
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                  allowfullscreen>
                </iframe>
              </div>
            </div>
          </div>
        </a>
        {% endfor -%}
      </section>
    </main>
    <footer>
      {% include footer.html %}
    </footer> 

    <script>
      // Store YouTube player instances
      const players = {};

      // Initialize YouTube Player API
      function onYouTubeIframeAPIReady() {
        const iframes = document.querySelectorAll("iframe[data-src]");
        iframes.forEach((iframe, index) => {
          const playerId = `player-${index + 1}`;
          iframe.id = playerId; // Assign unique ID
          players[playerId] = new YT.Player(playerId, {
            events: {
              onReady: (event) => {
                iframe.dataset.ready = true; // Mark the iframe as ready
              }
            }
          });
        });
      }

      // Start the video on hover
      function startVideo(element) {
        const iframe = element.querySelector("iframe");
        if (!iframe.src || iframe.src === "about:blank") {
          iframe.src = iframe.dataset.src; // Set the actual video URL
        }
      }

      // Pause the video on hover out
      function pauseVideo(element) {
        const iframe = element.querySelector("iframe");
        iframe.src = "about:blank"; // Reset the video URL to stop playback
      }
    </script>
  </body>
</html>